# QA Report for [Predy](https://github.com/code-423n4/2024-05-predy) by K42

- Note: I made sure these are unique and not covered on the `4naly3er` report.

### Table of Contents
- [Summary](#summary)
- [List of All Lows Covered](#list-of-all-lows-covered)
- [Low Severity Issues](#low-severity-issues)

## Summary
| Issue Type | Count |
| --- | --- |
| Low Severity Issues | 32 |
| Total Issues | 32 |

## List of All Lows Covered
1. **[PredyPool.sol](https://github.com/code-423n4/2024-05-predy/blob/main/src/PredyPool.sol): Lack of input validation for `pairId` in `updateAssetRiskParams`** ✅
2. **[PriceFeed.sol](https://github.com/code-423n4/2024-05-predy/blob/main/src/PriceFeed.sol): Lack of input validation for `quoteAnswer`** ✅
3. **[SettlementCallbackLib.sol](https://github.com/code-423n4/2024-05-predy/blob/main/src/hooks/SettlementCallbackLib.sol): Potential loss of funds when `price` is zero in `sell` function** ✅
4. **[BaseMarketUpgradable.sol](https://github.com/code-423n4/2024-05-predy/blob/main/src/hooks/BaseMarketUpgradable.sol): Missing input validation for `quoterAddress` in `__BaseMarket_init`** ✅
5. **[BaseMarket.sol](https://github.com/code-423n4/2024-05-predy/blob/main/src/markets/BaseMarket.sol): Lack of access control for `reallocate` function** ✅
6. **[BaseMarketUpgradable.sol](https://github.com/code-423n4/2024-05-predy/blob/main/src/markets/BaseMarketUpgradable.sol): Lack of input validation for `closeRatio` in `execLiquidationCall`** ✅
7. **[SettlementCallbackLib.sol](https://github.com/code-423n4/2024-05-predy/blob/main/src/markets/SettlementCallbackLib.sol): Missing input validation for `sellAmount` in `sell` function** ✅
8. **[PerpFee.sol](https://github.com/code-423n4/2024-05-predy/blob/main/src/libraries/PerpFee.sol): Lack of overflow checks for rebalance interest calculations** ✅
9. **[Perp.sol](https://github.com/code-423n4/2024-05-predy/blob/main/src/libraries/Perp.sol): Lack of input validation for `pairStatus` in `updateRebalanceInterestGrowth`** ✅
10. **[Trade.sol](https://github.com/code-423n4/2024-05-predy/blob/main/src/libraries/Trade.sol): Lack of input validation for `settlementData` in `trade` function** ✅
11. **[Perp.sol](https://github.com/code-423n4/2024-05-predy/blob/main/src/libraries/Perp.sol): Lack of event emission for `finalizeReallocation`** ✅
12. **[PositionCalculator.sol](https://github.com/code-423n4/2024-05-predy/blob/main/src/libraries/PositionCalculator.sol): Hardcoded risk ratio value** ✅
13. **[ApplyInterestLib.sol](https://github.com/code-423n4/2024-05-predy/blob/main/src/libraries/ApplyInterestLib.sol): Inefficient storage reads** ✅
14. **[Trade.sol](https://github.com/code-423n4/2024-05-predy/blob/main/src/libraries/Trade.sol): Unnecessary variable assignment** ✅
15. **[PositionCalculator.sol](https://github.com/code-423n4/2024-05-predy/blob/main/src/libraries/PositionCalculator.sol): Unnecessary variable assignments** ✅
16. **[AddPairLogic.sol](https://github.com/code-423n4/2024-05-predy/blob/main/src/libraries/logic/AddPairLogic.sol): Lack of zero address checks for `_poolOwner`** ✅
17. **[LiquidationLogic.sol](https://github.com/code-423n4/2024-05-predy/blob/main/src/libraries/logic/LiquidationLogic.sol): Lack of input validation for `settlementData` in `liquidate`** ✅
18. **[ReallocationLogic.sol](https://github.com/code-423n4/2024-05-predy/blob/main/src/libraries/logic/ReallocationLogic.sol): Lack of input validation for `settlementData` in `reallocate`** ✅
19. **[TradeLogic.sol](https://github.com/code-423n4/2024-05-predy/blob/main/src/libraries/logic/TradeLogic.sol): Lack of input validation for `settlementData` in `trade`** ✅
20. **[LPMath.sol](https://github.com/code-423n4/2024-05-predy/blob/main/src/libraries/math/LPMath.sol): Lack of input validation for `tickA` and `tickB` in `calculateAmount0ForLiquidityWithTicks`** ✅
21. **[LPMath.sol](https://github.com/code-423n4/2024-05-predy/blob/main/src/libraries/math/LPMath.sol): Lack of input validation for `tickA` and `tickB` in `calculateAmount1ForLiquidityWithTicks`** ✅
22. **[DecayLib.sol](https://github.com/code-423n4/2024-05-predy/blob/main/src/libraries/orders/DecayLib.sol): Lack of input validation for `decayEndTime` and `value` in `decay2`** ✅
23. **[ResolvedOrderLib.sol](https://github.com/code-423n4/2024-05-predy/blob/main/src/libraries/orders/ResolvedOrderLib.sol): Lack of input validation for `resolvedOrder.info.market` in `validate`** ✅
24. **[GammaTradeMarket.sol](https://github.com/code-423n4/2024-05-predy/blob/main/src/markets/gamma/GammaTradeMarket.sol): Missing input validation for `settlementParams` in `execLiquidationCall`** ✅
25. **[GammaTradeMarket.sol](https://github.com/code-423n4/2024-05-predy/blob/main/src/markets/gamma/GammaTradeMarket.sol): Missing input validation for `settlementParams` in `_executeTrade`** ✅
26. **[GammaTradeMarket.sol](https://github.com/code-423n4/2024-05-predy/blob/main/src/markets/gamma/GammaTradeMarket.sol): Missing input validation for `settlementParams` in `autoHedge`** ✅
27. **[GammaTradeMarket.sol](https://github.com/code-423n4/2024-05-predy/blob/main/src/markets/gamma/GammaTradeMarket.sol): Missing input validation for `settlementParams` in `autoClose`** ✅
28. **[PerpMarket.sol](https://github.com/code-423n4/2024-05-predy/blob/main/src/markets/perp/PerpMarket.sol): Missing input validation for `settlementParams` in `executeOrderV3L2`** ✅
29. **[PerpMarketV1.sol](https://github.com/code-423n4/2024-05-predy/blob/main/src/markets/perp/PerpMarketV1.sol): Missing input validation for `settlementParams` in `_executeOrderV3`** ✅
30. **[PerpMarketV1.sol](https://github.com/code-423n4/2024-05-predy/blob/main/src/markets/perp/PerpMarketV1.sol): Missing input validation for `settlementParams` in `quoteExecuteOrderV3`** ✅
31. **[SpotMarket.sol](https://github.com/code-423n4/2024-05-predy/blob/main/src/markets/spot/SpotMarket.sol): Missing input validation for `settlementParams` in `executeOrder`** ✅
32. **[SpotMarket.sol](https://github.com/code-423n4/2024-05-predy/blob/main/src/markets/spot/SpotMarket.sol): Missing input validation for `settlementParams` in `quoteSettlement`** ✅

## Low Severity Issues
1. **[PredyPool.sol](https://github.com/code-423n4/2024-05-predy/blob/main/src/PredyPool.sol): Lack of input validation for `pairId` in `updateAssetRiskParams`**
   - Description: The `updateAssetRiskParams` function does not validate if `pairId` exists in `globalData.pairs` mapping before accessing it. This could lead to unexpected behavior if an invalid `pairId` is provided.
   - Recommendation: Add a check to ensure `pairId` is a valid key in `globalData.pairs` mapping before accessing it.
   - Code Snippet:
     ```solidity
     function updateAssetRiskParams(uint256 pairId, Perp.AssetRiskParams memory riskParams)
         external
         onlyPoolOwner(pairId)
     {
         require(pairId < globalData.pairs.length, "Invalid pairId");
         AddPairLogic.updateAssetRiskParams(globalData.pairs[pairId], riskParams);
     }
     ```

2. **[PriceFeed.sol](https://github.com/code-423n4/2024-05-predy/blob/main/src/PriceFeed.sol): Lack of input validation for `quoteAnswer`**
   - Description: The `getSqrtPrice` function does not validate if `quoteAnswer` is zero before using it as a divisor. This could lead to a division by zero error.
   - Recommendation: Add a check to ensure `quoteAnswer` is not zero before using it as a divisor.
   - Code Snippet:
     ```solidity
     function getSqrtPrice() external view returns (uint256 sqrtPrice) {
        (, int256 quoteAnswer,,,) = AggregatorV3Interface(_quotePriceFeed).latestRoundData();
        require(quoteAnswer != 0, "Invalid quoteAnswer");
        // Rest of the code
     }
     ```

3. **[SettlementCallbackLib.sol](https://github.com/code-423n4/2024-05-predy/blob/main/src/hooks/SettlementCallbackLib.sol): Potential loss of funds when `price` is zero in `sell` function**
   - Description: In the `sell` function, when `price` is zero and `settlementParams.contractAddress` is not zero, the `quoteAmountFromUni` is directly transferred to the `predyPool` without considering the actual `price`. This could lead to a potential loss of funds if the `quoteAmountFromUni` is less than the expected `quoteAmount` based on the actual `price`.
   - Recommendation: Consider adding a check to ensure that when `price` is zero, the `quoteAmountFromUni` is greater than or equal to the expected `quoteAmount` based on the actual `price`. If the condition is not met, the transaction should revert to prevent loss of funds.
   - Code Snippet:
     ```solidity
     if (price == 0) {
         require(quoteAmountFromUni >= sellAmount * actualPrice / Constants.Q96, "Insufficient quote amount");
         ERC20(quoteToken).safeTransfer(address(predyPool), quoteAmountFromUni);
     }
     ```

4. **[BaseMarketUpgradable.sol](https://github.com/code-423n4/2024-05-predy/blob/main/src/hooks/BaseMarketUpgradable.sol): Missing input validation for `quoterAddress` in `__BaseMarket_init`**
   - Description: The `__BaseMarket_init` function sets the `_quoter` variable with the provided `quoterAddress` without validating if the address is a valid contract address. This could lead to unexpected behavior if an invalid address is provided.
   - Recommendation: Add a check to ensure that `quoterAddress` is a valid contract address before setting the `_quoter` variable.
   - Code Snippet:
     ```solidity
     function __BaseMarket_init(IPredyPool predyPool, address _whitelistFiller, address quoterAddress)
         internal
         onlyInitializing
     {
         require(quoterAddress.code.length > 0, "Invalid quoter address");
         // ...
     }
     ```

5. **[BaseMarket.sol](https://github.com/code-423n4/2024-05-predy/blob/main/src/markets/BaseMarket.sol): Lack of access control for `reallocate` function**
   - Description: The `reallocate` function in `BaseMarket` contract does not have any access control. This allows any address to call the function and potentially manipulate the settlement parameters.
   - Recommendation: Add appropriate access control to the `reallocate` function, such as restricting it to authorized addresses or requiring certain conditions to be met before executing the function.
   - Code Snippet:
     ```solidity
     function reallocate(uint256 pairId, IFillerMarket.SettlementParams memory settlementParams)
         external
         returns (bool relocationOccurred)
     {
         return _predyPool.reallocate(pairId, _getSettlementData(settlementParams));
     }
     ```

6. **[BaseMarketUpgradable.sol](https://github.com/code-423n4/2024-05-predy/blob/main/src/markets/BaseMarketUpgradable.sol): Lack of input validation for `closeRatio` in `execLiquidationCall`**
   - Description: The `execLiquidationCall` function in `BaseMarketUpgradable` contract does not validate the `closeRatio` parameter. This could lead to unexpected behavior if an invalid or out-of-range value is provided.
   - Recommendation: Add input validation for `closeRatio` to ensure it falls within a valid range (e.g., between 0 and 100).
   - Code Snippet:
     ```solidity
     function execLiquidationCall(
         uint256 vaultId,
         uint256 closeRatio,
         IFillerMarket.SettlementParamsV3 memory settlementParams
     ) external virtual returns (IPredyPool.TradeResult memory) {
         return
             _predyPool.execLiquidationCall(vaultId, closeRatio, _getSettlementDataFromV3(settlementParams, msg.sender));
     }
     ```

7. **[SettlementCallbackLib.sol](https://github.com/code-423n4/2024-05-predy/blob/main/src/markets/SettlementCallbackLib.sol): Missing input validation for `sellAmount` in `sell` function**
   - Description: The `sell` function in `SettlementCallbackLib` does not validate the `sellAmount` parameter. If `sellAmount` is zero, it could lead to unexpected behavior or waste of gas.
   - Recommendation: Add a check to ensure `sellAmount` is greater than zero before proceeding with the sell operation.
   - Code Snippet:
     ```solidity
     function sell(
         IPredyPool predyPool,
         address quoteToken,
         address baseToken,
         SettlementParams memory settlementParams,
         address sender,
         uint256 price,
         uint256 sellAmount
     ) internal {
         // Add check: require(sellAmount > 0, "Invalid sellAmount");
         // ...
     }
     ```

8. **[PerpFee.sol](https://github.com/code-423n4/2024-05-predy/blob/main/src/libraries/PerpFee.sol): Lack of overflow checks for rebalance interest calculations**
   - Description: The `computeRebalanceInterest` function performs calculations using `assetStatus.rebalanceInterestGrowthBase` and `assetStatus.rebalanceInterestGrowthQuote` without checking for potential overflow. This could lead to unexpected results or overflow errors.
   - Recommendation: Add overflow checks or use safe math libraries to prevent potential overflow issues in the rebalance interest calculations.
   - Code Snippet:
     ```solidity
     rebalanceInterestBase = Math.mulDivDownInt256(
         assetStatus.rebalanceInterestGrowthBase - rebalanceFeeGrowthCache[rebalanceId].underlyingGrowth,
         rebalanceAmount,
         Constants.ONE
     );
     rebalanceInterestQuote = Math.mulDivDownInt256(
         assetStatus.rebalanceInterestGrowthQuote - rebalanceFeeGrowthCache[rebalanceId].stableGrowth,
         rebalanceAmount,
         Constants.ONE
     );
     ```

9. **[Perp.sol](https://github.com/code-423n4/2024-05-predy/blob/main/src/libraries/Perp.sol): Lack of input validation for `pairStatus` in `updateRebalanceInterestGrowth`**
   - Description: The `updateRebalanceInterestGrowth` function does not validate the `pairStatus` parameter before using it. This could lead to unexpected behavior if an invalid or malicious `pairStatus` is provided.
   - Recommendation: Add input validation for `pairStatus` to ensure it is a valid and expected value before using it in the function.
   - Code Snippet:
     ```solidity
     function updateRebalanceInterestGrowth(
         DataType.PairStatus memory _pairStatus,
         SqrtPerpAssetStatus storage _sqrtAssetStatus
     ) internal {
         // ...
     }
     ```

10. **[Trade.sol](https://github.com/code-423n4/2024-05-predy/blob/main/src/libraries/Trade.sol): Lack of input validation for `settlementData` in `trade` function**
    - Description: The `trade` function does not validate the `settlementData` parameter before passing it to the `swap` function. This could lead to unexpected behavior or potential vulnerabilities if malicious settlement data is provided.
    - Recommendation: Add input validation for `settlementData` to ensure it is a valid and expected value before using it in the `swap` function.
    - Code Snippet:
      ```solidity
      SwapStableResult memory swapResult = swap(
          globalData,
          tradeParams.pairId,
          SwapStableResult(-tradeParams.tradeAmount, underlyingAmountForSqrt, realizedFee.feeAmountBase, 0),
          settlementData,
          tradeResult.sqrtPrice,
          tradeParams.vaultId
      );
      ```

11. **[Perp.sol](https://github.com/code-423n4/2024-05-predy/blob/main/src/libraries/Perp.sol): Lack of event emission for `finalizeReallocation`**
    - Description: The `finalizeReallocation` function updates the `lastRebalanceTotalSquartAmount` and `numRebalance` variables in the `SqrtPerpAssetStatus` struct, but does not emit an event to notify external entities about these changes. This can make it difficult to track and monitor the reallocation process.
    - Recommendation: Consider adding an event emission in the `finalizeReallocation` function to provide transparency and facilitate monitoring of the reallocation process.
    - Code Snippet:
      ```solidity
      event ReallocationFinalized(uint256 indexed pairId, uint256 lastRebalanceTotalSquartAmount, uint64 numRebalance);

      function finalizeReallocation(SqrtPerpAssetStatus storage sqrtPerpStatus) internal {
          sqrtPerpStatus.lastRebalanceTotalSquartAmount = sqrtPerpStatus.totalAmount + sqrtPerpStatus.borrowedAmount;
          sqrtPerpStatus.numRebalance++;
          emit ReallocationFinalized(pairId, sqrtPerpStatus.lastRebalanceTotalSquartAmount, sqrtPerpStatus.numRebalance);
      }
      ```

12. **[PositionCalculator.sol](https://github.com/code-423n4/2024-05-predy/blob/main/src/libraries/PositionCalculator.sol): Hardcoded risk ratio value**
    - Description: The `RISK_RATIO_ONE` constant in the `PositionCalculator` library is hardcoded with a value of `1e8`. This hardcoded value reduces the flexibility and maintainability of the contract, as any changes to the risk ratio would require a contract update.
    - Recommendation: Consider making the risk ratio value configurable through a contract parameter or a setter function, allowing for easier adjustments without requiring a contract update.
    - Code Snippet:
      ```solidity
      uint256 public riskRatioOne;

      constructor(uint256 _riskRatioOne) {
          riskRatioOne = _riskRatioOne;
      }

      function setRiskRatioOne(uint256 _riskRatioOne) external onlyOwner {
          riskRatioOne = _riskRatioOne;
      }
      ```

13. **[ApplyInterestLib.sol](https://github.com/code-423n4/2024-05-predy/blob/main/src/libraries/ApplyInterestLib.sol): Inefficient storage reads**
    - Description: The `applyInterestForToken` function reads the `pairStatus` storage variable multiple times, which can lead to unnecessary gas consumption. Solidity optimizes storage reads by caching the value in memory, but multiple reads of the same storage variable can still be inefficient.
    - Recommendation: Consider reading the `pairStatus` variable into a memory variable at the beginning of the function and using the memory variable throughout the function to reduce the number of storage reads.
    - Code Snippet:
      ```solidity
      function applyInterestForToken(mapping(uint256 => DataType.PairStatus) storage pairs, uint256 pairId) internal {
          DataType.PairStatus memory pairStatusMem = pairs[pairId];
          
          // Use pairStatusMem instead of pairStatus
          Perp.updateFeeAndPremiumGrowth(pairId, pairStatusMem.sqrtAssetStatus);

          if (pairStatusMem.lastUpdateTimestamp >= block.timestamp) {
              return;
          }

          // ...
      }
      ```

14. **[Trade.sol](https://github.com/code-423n4/2024-05-predy/blob/main/src/libraries/Trade.sol): Unnecessary variable assignment**
    - Description: The `settleUserBalanceAndFee` function assigns the result of `PerpFee.settleUserFee` to the `realizedFee` variable, but then immediately calls `Perp.settleUserBalance` without using the `realizedFee` variable. This assignment is unnecessary and can be removed to improve code clarity and reduce gas consumption.
    - Recommendation: Remove the unnecessary assignment to the `realizedFee` variable.
    - Code Snippet:
      ```solidity
      function settleUserBalanceAndFee(
          DataType.PairStatus storage _pairStatus,
          mapping(uint256 => DataType.RebalanceFeeGrowthCache) storage rebalanceFeeGrowthCache,
          Perp.UserStatus storage _userStatus
      ) internal returns (DataType.FeeAmount memory realizedFee) {
          realizedFee = PerpFee.settleUserFee(_pairStatus, rebalanceFeeGrowthCache, _userStatus);
          Perp.settleUserBalance(_pairStatus, _userStatus);
      }
      ```

15. **[PositionCalculator.sol](https://github.com/code-423n4/2024-05-predy/blob/main/src/libraries/PositionCalculator.sol): Unnecessary variable assignments**
    - Description: The `getPositionWithFeeAmount` function assigns the values of `perpUserStatus.perp.entryValue`, `perpUserStatus.sqrtPerp.entryValue`, and `perpUserStatus.perp.amount` to local variables `amountQuote`, `amountSqrt`, and `amountBase`, respectively. However, these local variables are immediately used to construct and return the `PositionParams` struct, making the assignments unnecessary.
    - Recommendation: Remove the unnecessary variable assignments and directly use the struct members in the `PositionParams` constructor.
    - Code Snippet:
      ```solidity
      function getPositionWithFeeAmount(Perp.UserStatus memory perpUserStatus, DataType.FeeAmount memory feeAmount)
          internal
          pure
          returns (PositionParams memory positionParams)
      {
          return PositionParams(
              perpUserStatus.perp.entryValue + perpUserStatus.sqrtPerp.entryValue + feeAmount.feeAmountQuote,
              perpUserStatus.sqrtPerp.amount,
              perpUserStatus.perp.amount + feeAmount.feeAmountBase
          );
      }
      ```

16. **[AddPairLogic.sol](https://github.com/code-423n4/2024-05-predy/blob/main/src/libraries/logic/AddPairLogic.sol): Lack of zero address checks for `_poolOwner`**
    - Description: The `validatePoolOwner` function checks if `_poolOwner` is not the zero address, but it does not check for the zero address when setting the `poolOwner` in the `_storePairStatus` function. This could lead to a pair being created with an invalid pool owner.
    - Recommendation: Add a zero address check for `_addPairParam.poolOwner` in the `_storePairStatus` function.
    - Code Snippet:
      ```solidity
      function _storePairStatus(
          address quoteToken,
          mapping(uint256 => DataType.PairStatus) storage _pairs,
          uint256 _pairId,
          address _tokenAddress,
          bool _isQuoteZero,
          AddPairParams memory _addPairParam
      ) internal {
          require(_addPairParam.poolOwner != address(0), "Invalid pool owner");
          // ...
      }
      ```

17. **[LiquidationLogic.sol](https://github.com/code-423n4/2024-05-predy/blob/main/src/libraries/logic/LiquidationLogic.sol): Lack of input validation for `settlementData` in `liquidate`**
    - Description: The `liquidate` function passes the `settlementData` parameter directly to the `Trade.trade` function without validating its contents. This could lead to unexpected behavior or potential vulnerabilities if malicious settlement data is provided.
    - Recommendation: Add input validation for `settlementData` to ensure it is a valid and expected value before passing it to the `Trade.trade` function.
    - Code Snippet:
      ```solidity
      function liquidate(
          uint256 vaultId,
          uint256 closeRatio,
          GlobalDataLibrary.GlobalData storage globalData,
          bytes memory settlementData
      ) external returns (IPredyPool.TradeResult memory tradeResult) {
          // Add validation for settlementData
          require(isValidSettlementData(settlementData), "Invalid settlement data");
          // ...
      }
      ```

18. **[ReallocationLogic.sol](https://github.com/code-423n4/2024-05-predy/blob/main/src/libraries/logic/ReallocationLogic.sol): Lack of input validation for `settlementData` in `reallocate`**
    - Description: The `reallocate` function passes the `settlementData` parameter directly to the `globalData.callSettlementCallback` function without validating its contents. This could lead to unexpected behavior or potential vulnerabilities if malicious settlement data is provided.
    - Recommendation: Add input validation for `settlementData` to ensure it is a valid and expected value before passing it to the `globalData.callSettlementCallback` function.
    - Code Snippet:
      ```solidity
      function reallocate(GlobalDataLibrary.GlobalData storage globalData, uint256 pairId, bytes memory settlementData)
          external
          returns (bool isRangeChanged)
      {
          // Add validation for settlementData
          require(isValidSettlementData(settlementData), "Invalid settlement data");
          // ...
      }
      ```

19. **[TradeLogic.sol](https://github.com/code-423n4/2024-05-predy/blob/main/src/libraries/logic/TradeLogic.sol): Lack of input validation for `settlementData` in `trade`**
    - Description: The `trade` function passes the `settlementData` parameter directly to the `Trade.trade` function without validating its contents. This could lead to unexpected behavior or potential vulnerabilities if malicious settlement data is provided.
    - Recommendation: Add input validation for `settlementData` to ensure it is a valid and expected value before passing it to the `Trade.trade` function.
    - Code Snippet:
      ```solidity
      function trade(
          GlobalDataLibrary.GlobalData storage globalData,
          IPredyPool.TradeParams memory tradeParams,
          bytes memory settlementData
      ) external returns (IPredyPool.TradeResult memory tradeResult) {
          // Add validation for settlementData
          require(isValidSettlementData(settlementData), "Invalid settlement data");
          // ...
      }
      ```

20. **[LPMath.sol](https://github.com/code-423n4/2024-05-predy/blob/main/src/libraries/math/LPMath.sol): Lack of input validation for `tickA` and `tickB` in `calculateAmount0ForLiquidityWithTicks`**
    - Description: The `calculateAmount0ForLiquidityWithTicks` function does not validate if `tickA` and `tickB` are within the valid tick range defined by `TickMath.MIN_TICK` and `TickMath.MAX_TICK`. This could lead to unexpected results or reverts if invalid tick values are provided.
    - Recommendation: Add input validation to ensure `tickA` and `tickB` are within the valid tick range before passing them to `TickMath.getSqrtRatioAtTick`.
    - Code Snippet:
      ```solidity
      function calculateAmount0ForLiquidityWithTicks(int24 tickA, int24 tickB, uint256 liquidityAmount, bool isRoundUp)
          internal
          pure
          returns (int256)
      {
          require(tickA >= TickMath.MIN_TICK && tickA <= TickMath.MAX_TICK, "Invalid tickA");
          require(tickB >= TickMath.MIN_TICK && tickB <= TickMath.MAX_TICK, "Invalid tickB");
          // ...
      }
      ```

21. **[LPMath.sol](https://github.com/code-423n4/2024-05-predy/blob/main/src/libraries/math/LPMath.sol): Lack of input validation for `tickA` and `tickB` in `calculateAmount1ForLiquidityWithTicks`**
    - Description: The `calculateAmount1ForLiquidityWithTicks` function does not validate if `tickA` and `tickB` are within the valid tick range defined by `TickMath.MIN_TICK` and `TickMath.MAX_TICK`. This could lead to unexpected results or reverts if invalid tick values are provided.
    - Recommendation: Add input validation to ensure `tickA` and `tickB` are within the valid tick range before passing them to `TickMath.getSqrtRatioAtTick`.
    - Code Snippet:
      ```solidity
      function calculateAmount1ForLiquidityWithTicks(int24 tickA, int24 tickB, uint256 liquidityAmount, bool isRoundUp)
          internal
          pure
          returns (int256)
      {
          require(tickA >= TickMath.MIN_TICK && tickA <= TickMath.MAX_TICK, "Invalid tickA");
          require(tickB >= TickMath.MIN_TICK && tickB <= TickMath.MAX_TICK, "Invalid tickB");
          // ...
      }
      ```

22. **[DecayLib.sol](https://github.com/code-423n4/2024-05-predy/blob/main/src/libraries/orders/DecayLib.sol): Lack of input validation for `decayEndTime` and `value` in `decay2`**
    - Description: The `decay2` function does not validate if `decayEndTime` is greater than or equal to `value`. If `decayEndTime` is less than `value`, the function will return `endPrice` without considering the actual decay calculation. This could lead to incorrect pricing results.
    - Recommendation: Add a check to ensure `decayEndTime` is greater than or equal to `value` before performing the decay calculation.
    - Code Snippet:
      ```solidity
      function decay2(uint256 startPrice, uint256 endPrice, uint256 decayStartTime, uint256 decayEndTime, uint256 value)
          internal
          pure
          returns (uint256 decayedPrice)
      {
          if (decayEndTime < decayStartTime) {
              revert EndTimeBeforeStartTime();
          } else if (decayEndTime <= value) {
              // Add a check to ensure decayEndTime >= value
              require(decayEndTime >= value, "Invalid decayEndTime");
              decayedPrice = endPrice;
          } else if (decayStartTime >= value) {
              decayedPrice = startPrice;
          } else {
              // ...
          }
      }
      ```

23. **[ResolvedOrderLib.sol](https://github.com/code-423n4/2024-05-predy/blob/main/src/libraries/orders/ResolvedOrderLib.sol): Lack of input validation for `resolvedOrder.info.market` in `validate`**
    - Description: The `validate` function checks if `address(this)` is equal to `address(resolvedOrder.info.market)`, but it does not validate if `resolvedOrder.info.market` is a valid address. If an invalid or zero address is passed, the comparison will always fail, and the function will revert with `InvalidMarket` error.
    - Recommendation: Add a check to ensure `resolvedOrder.info.market` is a valid address before performing the comparison.
    - Code Snippet:
      ```solidity
      function validate(ResolvedOrder memory resolvedOrder) internal view {
          // Add a check to ensure resolvedOrder.info.market is a valid address
          require(resolvedOrder.info.market != address(0), "Invalid market address");
          
          if (address(this) != address(resolvedOrder.info.market)) {
              revert InvalidMarket();
          }
          
          if (block.timestamp > resolvedOrder.info.deadline) {
              revert DeadlinePassed();
          }
      }
      ```

24. **[GammaTradeMarket.sol](https://github.com/code-423n4/2024-05-predy/blob/main/src/markets/gamma/GammaTradeMarket.sol): Missing input validation for `settlementParams` in `execLiquidationCall`**
    - Description: The `execLiquidationCall` function passes the `settlementParams` parameter directly to the `_getSettlementDataFromV3` function without validating its contents. This could lead to unexpected behavior or potential vulnerabilities if malicious settlement data is provided.
    - Recommendation: Add input validation for `settlementParams` to ensure it is a valid and expected value before passing it to the `_getSettlementDataFromV3` function.
    - Code Snippet:
      ```solidity
      function execLiquidationCall(
          uint256 vaultId,
          uint256 closeRatio,
          IFillerMarket.SettlementParamsV3 memory settlementParams
      ) external override returns (IPredyPool.TradeResult memory tradeResult) {
          // Add validation for settlementParams
          require(isValidSettlementParams(settlementParams), "Invalid settlement params");
          tradeResult =
              _predyPool.execLiquidationCall(vaultId, closeRatio, _getSettlementDataFromV3(settlementParams, msg.sender));
          // ...
      }
      ```

25. **[GammaTradeMarket.sol](https://github.com/code-423n4/2024-05-predy/blob/main/src/markets/gamma/GammaTradeMarket.sol): Missing input validation for `settlementParams` in `_executeTrade`**
    - Description: The `_executeTrade` function passes the `settlementParams` parameter directly to the `_getSettlementDataFromV3` function without validating its contents. This could lead to unexpected behavior or potential vulnerabilities if malicious settlement data is provided.
    - Recommendation: Add input validation for `settlementParams` to ensure it is a valid and expected value before passing it to the `_getSettlementDataFromV3` function.
    - Code Snippet:
      ```solidity
      function _executeTrade(GammaOrder memory gammaOrder, bytes memory sig, SettlementParamsV3 memory settlementParams)
          internal
          returns (IPredyPool.TradeResult memory tradeResult)
      {
          // Add validation for settlementParams
          require(isValidSettlementParams(settlementParams), "Invalid settlement params");
          // ...
          tradeResult = _predyPool.trade(
              IPredyPool.TradeParams(
                  // ...
              ),
              _getSettlementDataFromV3(settlementParams, msg.sender)
          );
          // ...
      }
      ```

26. **[GammaTradeMarket.sol](https://github.com/code-423n4/2024-05-predy/blob/main/src/markets/gamma/GammaTradeMarket.sol): Missing input validation for `settlementParams` in `autoHedge`**
    - Description: The `autoHedge` function passes the `settlementParams` parameter directly to the `_getSettlementDataFromV3` function without validating its contents. This could lead to unexpected behavior or potential vulnerabilities if malicious settlement data is provided.
    - Recommendation: Add input validation for `settlementParams` to ensure it is a valid and expected value before passing it to the `_getSettlementDataFromV3` function.
    - Code Snippet:
      ```solidity
      function autoHedge(uint256 positionId, SettlementParamsV3 memory settlementParams)
          external
          returns (IPredyPool.TradeResult memory tradeResult)
      {
          // Add validation for settlementParams
          require(isValidSettlementParams(settlementParams), "Invalid settlement params");
          // ...
          tradeResult = _predyPool.trade(tradeParams, _getSettlementDataFromV3(settlementParams, msg.sender));
          // ...
      }
      ```

27. **[GammaTradeMarket.sol](https://github.com/code-423n4/2024-05-predy/blob/main/src/markets/gamma/GammaTradeMarket.sol): Missing input validation for `settlementParams` in `autoClose`**
    - Description: The `autoClose` function passes the `settlementParams` parameter directly to the `_getSettlementDataFromV3` function without validating its contents. This could lead to unexpected behavior or potential vulnerabilities if malicious settlement data is provided.
    - Recommendation: Add input validation for `settlementParams` to ensure it is a valid and expected value before passing it to the `_getSettlementDataFromV3` function.
    - Code Snippet:
      ```solidity
      function autoClose(uint256 positionId, SettlementParamsV3 memory settlementParams)
          external
          returns (IPredyPool.TradeResult memory tradeResult)
      {
          // Add validation for settlementParams
          require(isValidSettlementParams(settlementParams), "Invalid settlement params");
          // ...
          tradeResult = _predyPool.trade(tradeParams, _getSettlementDataFromV3(settlementParams, msg.sender));
          // ...
      }
      ```

28. **[PerpMarket.sol](https://github.com/code-423n4/2024-05-predy/blob/main/src/markets/perp/PerpMarket.sol): Missing input validation for `settlementParams` in `executeOrderV3L2`**
    - Description: The `executeOrderV3L2` function passes the `settlementParams` parameter directly to the `_executeOrderV3` function without validating its contents. This could lead to unexpected behavior or potential vulnerabilities if malicious settlement data is provided.
    - Recommendation: Add input validation for `settlementParams` to ensure it is a valid and expected value before passing it to the `_executeOrderV3` function.
    - Code Snippet:
      ```solidity
      function executeOrderV3L2(
          PerpOrderV3L2 memory compressedOrder,
          bytes memory sig,
          SettlementParamsV3 memory settlementParams,
          uint64 orderId
      ) external nonReentrant returns (IPredyPool.TradeResult memory) {
          // Add validation for settlementParams
          require(isValidSettlementParams(settlementParams), "Invalid settlement params");
          // ...
          return _executeOrderV3(order, sig, settlementParams, orderId);
      }
      ```

29. **[PerpMarketV1.sol](https://github.com/code-423n4/2024-05-predy/blob/main/src/markets/perp/PerpMarketV1.sol): Missing input validation for `settlementParams` in `_executeOrderV3`**
    - Description: The `_executeOrderV3` function passes the `settlementParams` parameter directly to the `_getSettlementDataFromV3` function without validating its contents. This could lead to unexpected behavior or potential vulnerabilities if malicious settlement data is provided.
    - Recommendation: Add input validation for `settlementParams` to ensure it is a valid and expected value before passing it to the `_getSettlementDataFromV3` function.
    - Code Snippet:
      ```solidity
      function _executeOrderV3(
          PerpOrderV3 memory perpOrder,
          bytes memory sig,
          SettlementParamsV3 memory settlementParams,
          uint64 orderId
      ) internal returns (IPredyPool.TradeResult memory tradeResult) {
          // Add validation for settlementParams
          require(isValidSettlementParams(settlementParams), "Invalid settlement params");
          // ...
          tradeResult = _predyPool.trade(
              IPredyPool.TradeParams(
                  // ...
              ),
              _getSettlementDataFromV3(settlementParams, msg.sender)
          );
          // ...
      }
      ```

30. **[PerpMarketV1.sol](https://github.com/code-423n4/2024-05-predy/blob/main/src/markets/perp/PerpMarketV1.sol): Missing input validation for `settlementParams` in `quoteExecuteOrderV3`**
    - Description: The `quoteExecuteOrderV3` function passes the `settlementParams` parameter directly to the `_getSettlementDataFromV3` function without validating its contents. This could lead to unexpected behavior or potential vulnerabilities if malicious settlement data is provided.
    - Recommendation: Add input validation for `settlementParams` to ensure it is a valid and expected value before passing it to the `_getSettlementDataFromV3` function.
    - Code Snippet:
      ```solidity
      function quoteExecuteOrderV3(
          PerpOrderV3 memory perpOrder,
          SettlementParamsV3 memory settlementParams,
          address filler
      ) external {
          // Add validation for settlementParams
          require(isValidSettlementParams(settlementParams), "Invalid settlement params");
          // ...
          _predyPool.trade(
              IPredyPool.TradeParams(
                  // ...
              ),
              _getSettlementDataFromV3(settlementParams, filler)
          );
      }
      ```

31. **[SpotMarket.sol](https://github.com/code-423n4/2024-05-predy/blob/main/src/markets/spot/SpotMarket.sol): Missing input validation for `settlementParams` in `executeOrder`**
    - Description: The `executeOrder` function passes the `settlementParams` parameter directly to the `_executeOrder` function without validating its contents. This could lead to unexpected behavior or potential vulnerabilities if malicious settlement data is provided.
    - Recommendation: Add input validation for `settlementParams` to ensure it is a valid and expected value before passing it to the `_executeOrder` function.
    - Code Snippet:
      ```solidity
      function executeOrder(SignedOrder memory order, SettlementParams memory settlementParams)
          external
          returns (int256 quoteTokenAmount)
      {
          // Add validation for settlementParams
          require(isValidSettlementParams(settlementParams), "Invalid settlement params");
          // ...
          return _executeOrder(perpOrder, order.sig, settlementParams);
      }
      ```

32. **[SpotMarket.sol](https://github.com/code-423n4/2024-05-predy/blob/main/src/markets/spot/SpotMarket.sol): Missing input validation for `settlementParams` in `quoteSettlement`**
    - Description: The `quoteSettlement` function passes the `settlementParams` parameter directly to the `_quoteSell` and `_quoteBuy` functions without validating its contents. This could lead to unexpected behavior or potential vulnerabilities if malicious settlement data is provided.
    - Recommendation: Add input validation for `settlementParams` to ensure it is a valid and expected value before passing it to the `_quoteSell` and `_quoteBuy` functions.
    - Code Snippet:
      ```solidity
      function quoteSettlement(SettlementParams memory settlementParams, int256 baseAmountDelta) external {
          // Add validation for settlementParams
          require(isValidSettlementParams(settlementParams), "Invalid settlement params");
          // ...
          if (baseAmountDelta > 0) {
              quoteAmount += _quoteSell(settlementParams, settlementParams.price, uint256(baseAmountDelta));
          } else if (baseAmountDelta < 0) {
              quoteAmount += _quoteBuy(settlementParams, settlementParams.price, uint256(-baseAmountDelta));
          }
          // ...
      }
      ```